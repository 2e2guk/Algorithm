# NetWork Flow #

### Initial approach ###
서울역에서, 부산역까지 물류를 기찻길을 통해서 보낸다고 해 보자. 당연히 서울역과 부산역 사이에는 많은 역들이 존재한다.(지금 들어오는 열차는 우리 역을 통과하는 열차입니다)

그리고, 각 역을 잇는 기찻길에는, 한번에 보낼 수 있는 양에 제한이 있다고 하자. 예를 들면, **"이 기찻길을 통해서는, 5톤 이상의 화물을 보낼 수 없습니다"** 와 같은 제한들이 주어진다. 

이때, 서울역에서 부산역까지, 최대로 보낼 수 있는 물류의 양은 얼마나 될까? 더 나아가서, 기찻길의 이용료까지 지불해야 할때, 최소 비용으로, 최대의 물류를 어떻게 보낼 수 있을까? 

이와 같은 문제를 해결하는 분야가 **Network Flow** 이론이다. 
### Flow Network ###
-> directed graph G=(V, E)를 생각해 보자. flow network라는 것은, 그래프의 간선 집합 E에, **유량과 용량** 이라는 두 가중치를 부여한다. 

### a) flow(유량) f : E -> R

유량은, 간선에 부여되는 일종의 가중치이며, 실수 값을 갖는다. 위의 예시에서는, "현재 이 기찻길에, 얼마만큼의 물류가 지나가는가" 이다.

간선 e = (u, v)의 유량을, f(e)로 표현하자.

### b) capacity(용량) c : E -> R+ 

용량은, 간선에 부여되는 일종의 가중치이며, 양의 실수 값을 갖는다. 위의 예시에서는, "현재 이 기찻길에, 얼마만큼의 물류가 지나갈 수 있는가" 이다. 

간선 e = (u, v)의 용량을, c(e)로 표현하자.

### c) source s, sink t

소스 s와 싱크 t는, **정점** 인데, s에서는 유량이 발생하기만 하고, t에서는 유량이 소멸하기만 한다. 

위의 예시에서는, 서울은 s, 부산은 t라고 할 수 있다. 

### d) capacity constriant(용량 제한 법칙) 

G=(V, E)에서, 집합 E의 임의의 원소 e에 대해, **f(e) <= c(e)** 를 만족한다. 

어떻게 보면 당연한데, 위의 예시를 통해서 직관적으로 이해해 보자. 기찻길 e에 대해, 기찻길의 무게 제한 c(e)=5인데, 이 기찻길 e 위로는, 7의 물량(f(e)=7) 이 지나갈 수 없다. 기찻길이 박살난다. 

### e) flow conservation(유량 보존의 법칙) 

소스와 싱크를 제외한, 임의의 정점 u, v에 대해서, **sigma f(u, v) = sigma(v, u)** 를 만족한다. 즉, 소스와 싱크를 제외한 임의의 정점 v에 대해서, 

**이 정점으로 흘러 들어가는 유량과, 이 정점에서 흘러 나가는 유량의 각각의 합은 일치한다.** 라는 말이다. 

이도 어떻게 보면 당연한데, 위의 예시에서, 서울과 부산을 제외한 임의의 역, 예를 들면 수원역에 8만큼의 물량이 들어왔다고 하자. 그런데, 수원역에서 7만큼의 유량을 보내면, 물량 1만큼은 어디 꽁쳐놓는 거다..

이와 같은 상황을 막고자. flow conservation 조건을 건 것이다. 


### Flow Network?

그러면, **이 조건들을 만족하는 directed graph를, Flow Network** 라고 한다. directed graph임에 유의하자. 왜냐면, 언젠가 중요해지는 날이 오니까...(Stoer-Wagner Global Min-cut algorithm)


## 최대 유량 문제(Maximum Flow problem)의 정의 ##

여튼, 이렇게 구성한 Flow Network에서, 우리가 예시에서 구하고자 했던 것 중 하나인, **얼마나 많은 물량를 보낼 수 있는가** 가, 최대 유량 문제의 정의이다. 

**capacity c는, 상수값이다. 우리는, capacity constraint, flow conservation을 만족시키며, flow f를 최대화하는 것이 목표**다. 최대 유량 문제는 Optimization problem이다. 

그러면, 어떻게 할 수 있을까? naive 하게 생각해 보자. 

서울 -> 수원 -> 대전 -> 부산 의 경로를 생각하자(**소스 = 서울, 싱크 = 부산**). 이 경로를 통해, 물류를 보내는 상황을 생각해 보자. 

서울 -> 수원 : 용량 5

수원 -> 대전 : 용량 3

대전 -> 부산 : 용량 8

이라고 해 보고, 과연 서울에서 부산까지, 얼마 만큼의 유량을 보낼 수 있을까..? 정답은 3이다. 왜? 4의 유량을 보내면, 수원->대전 기찻길이 부서지고, 2의 유량을 보낼 수는 있지만, 이는 maximal하지 않다. 고로, 3이 정답이 된다. 

그러면, 3의 물량을 보냈다고 가정하자. 유량을 보내고 난 후, **서울 -> 수원 -> 대전 -> 부산 경로의 용량 값에는 변화**가 생긴다.

서울 -> 수원 : 용량 5-3 = 2

수원 -> 대전 : 용량 3-3 = 0

대전 -> 부산 : 용량 8-3 = 5

이 상황에서,동일한 경로로, 유량을 보낼 수 있을까? **보낼 수 없다.** 왜일까? **수원->대전 기찻길로는, 이미 가능한 최대 유량이 지나고 있기 때문**이다. 

그러면, 서울 -> 부산으로는, 최대 3만큼의 유량을 흘릴 수 있다. 

하지만, 모든 입력이 이렇게 단순하면 좋겠지만, 실제로는 그렇지 않다. 그러면, 이를 일반화해 보자. 

### 잔여 용량(residual capacity)과 증가 경로(augmenting path)

잔여 용량부터 알아보자. 잔여 용량이란, **용량이 c인 간선 e에 f만큼의 유량을 흘린 이후, 간선 e의 용량이, c-f로 줄어든 상태의 e의 용량** 을 말한다. 

그러니까, **흘린 유량만큼을, 기존 용량에서 빼 주는 것**이다. 왜 이런 짓을 할까? 일단, 정말 직관적으로 이해하자면, 만약 용량이 줄어들지 않으면, 세상의 모든 최대 유량 문제의 답은 무한대가 되기 때문이다. 

위의 예시에서, 수원-> 대전 기찻길의 용량이 3이고, 여기서 1만큼의 유량이 지나간다고 해 보자. 그러면, 이 기찻길 위로 추가로 지나갈 수 있는 유량은 **2**이다. 

